#!/usr/bin/env bash

# Check if gpg agent is running, otherwise start it
# echo RELOADAGENT | gpg-connect-agent >> /dev/null

# Check if connected
STATE=`ip route | grep " dev " | grep -v "docker" | wc -l`
##STATE=`nmcli networking connectivity`
#STATE=`LC_ALL=en_US.UTF-8 wicd-cli -i | grep "Connection status" | awk '{print $NF}'`

if [ $STATE -eq 0 ]
then
    echo "No internet connection."
else
    # ensure gpg-agent is running
    gpg-connect-agent /bye >> /dev/null
    # get new mails
    mbsync -qq -a
    # index new mails
    notmuch new --quiet
fi
exit 0
