#!/usr/bin/env bash

VERB=false

if [ -z ${PASSWORD_STORE_DIR+x} ];
then 
  passdir=$HOME"/.password-store"
else
  passdir=${PASSWORD_STORE_DIR}
fi

passids=( $(find $passdir -name "*.gpg" -printf "%P\n" | sed -e 's/\.gpg$//') )

if [ -z "$@" ];
then
  for passid in ${passids[@]};
  do
    base=$(dirname $passid)
    [[ $base == '.' ]] && base=' '
    name=$(basename $passid)
    if [ "$VERB" == true ];
    then
      printf '%-13s %s\n' "$base" $name
    else
      printf '%-13s %s\n' "$base" $name | grep -v "prova"
    fi
  done

else
  passid=$(echo $@ | tr -s " " "/")
  pass show --clip ${passid} 2> /dev/null 
  notify-send 'DPass:' "secret copied to clipboard\n (will be cleared in 45 sec.)"
fi

#vim ft:sh
